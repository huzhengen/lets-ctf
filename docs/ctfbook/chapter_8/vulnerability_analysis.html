<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>了解综合CTF挑战 - lets move ctf</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">lets move ctf</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="第8节综合ctf挑战"><a class="header" href="#第8节综合ctf挑战">第8节：综合CTF挑战</a></h1>
<p>欢迎来到Move CTF挑战课程的最后一节！通过前面的课程学习，你已经掌握了Sui Move CTF中会遇到的大部分漏洞类型，从代码层面的细节到架构层面的风险。你学会了识别泛型安全问题、如何绕过权限控制、利用逻辑漏洞，也理解了资源所有权和跨合约交互的陷阱等。</p>
<p>然而，在高水平的CTF挑战或真实世界的攻击中，漏洞往往不是孤立存在的。攻击者很少能通过一个简单的bug就直接得手。真正的挑战在于<strong>发现多个“小”漏洞，并将它们像拼图一样组合起来，构建出一条完整的、能够达成最终目标的攻击链</strong>。</p>
<p>本节课的目标不是解决某一个具体的题目，而是为你提供一个<strong>解题框架和思维模型</strong>，教你如何：</p>
<ol>
<li>像攻击者一样思考，从最终目标倒推攻击路径。</li>
<li>识别并将不同类型的漏洞串联起来，形成组合拳。</li>
<li>理解DeFi领域的经典攻击如何在Sui CTF中得到体现。</li>
<li>掌握解决复杂综合性问题的通用方法论。</li>
</ol>
<hr />
<h3 id="一-攻击链思维从单点突破到组合利用"><a class="header" href="#一-攻击链思维从单点突破到组合利用"><strong>一、 攻击链思维：从“单点突破”到“组合利用”</strong></a></h3>
<p>综合性挑战的核心是从“找到一个漏洞”转变为“规划一条攻击路径”。</p>
<p>想象一个多重门锁的保险库：</p>
<ul>
<li><strong>第一道门（权限入口）</strong>：可能是需要一个特殊的身份凭证。</li>
<li><strong>第二道门（业务逻辑）</strong>：可能需要满足某个特定的业务状态。</li>
<li><strong>第三道门（执行环节）</strong>：可能是调用一个有风险的内部函数。</li>
</ul>
<p>你找到的每一个漏洞，都只是打开其中一道门的钥匙。你的任务是找到所有钥匙，并按正确的顺序使用它们。</p>
<p><strong>一个典型的攻击链可能如下：</strong></p>
<p><code>漏洞A (初始入口)</code> -&gt; <code>获得某种权限或状态</code> -&gt; <code>利用新权限触发漏洞B (中间环节)</code> -&gt; <code>改变关键状态或绕过检查</code> -&gt; <code>触发漏洞C (最终执行)</code> -&gt; <code>达成目标（如盗取资金）</code></p>
<hr />
<h3 id="二-常见综合攻击模式与真实世界映射"><a class="header" href="#二-常见综合攻击模式与真实世界映射"><strong>二、 常见综合攻击模式与真实世界映射</strong></a></h3>
<p>很多CTF题目往往会结合前面我们学习到的多个漏洞，并且可能结合常见的Defi经济模型和真实的攻击案例，让我们回顾前几节课的知识，看看它们如何组合成强大的攻击模式，并与DeFi世界的真实攻击联系起来。</p>
<h4 id="模式1泛型安全漏洞--逻辑漏洞"><a class="header" href="#模式1泛型安全漏洞--逻辑漏洞"><strong>模式1：泛型安全漏洞 + 逻辑漏洞</strong></a></h4>
<ul>
<li><strong>漏洞组合</strong>：
<ol>
<li><strong>泛型类型安全漏洞</strong>：允许攻击者创建自定义的、非官方的虚假“凭证”对象（如伪造的投票凭证、会员卡）。</li>
<li><strong>状态管理逻辑漏洞</strong>：业务逻辑（如投票、领取空投）只检查凭证的存在或ID，而不验证其真实类型或来源，并且允许重复操作。</li>
</ol>
</li>
<li><strong>攻击流程</strong>：
<ol>
<li>攻击者利用泛型漏洞，在一个交易中创建大量伪造的凭证对象。</li>
<li>利用逻辑漏洞，使用这些伪造凭证重复执行某个有利可图的操作（如为自己的恶意提案投票、重复领取奖励）。</li>
</ol>
</li>
<li><strong>真实世界映射</strong>：这类似于在去中心化治理（DAO）中，攻击者通过漏洞凭空创造出大量投票权，然后通过一个看似“合法”的提案，将资金库或协议中的资金转移给自己。</li>
</ul>
<h4 id="模式2权限绕过--跨合约交互安全漏洞"><a class="header" href="#模式2权限绕过--跨合约交互安全漏洞"><strong>模式2：权限绕过 + 跨合约交互安全漏洞</strong></a></h4>
<ul>
<li>
<p><strong>漏洞组合</strong>：</p>
<ol>
<li><strong>权限与访问控制漏洞</strong>：合约中某个强大的<code>Public</code>函数（例如 <code>execute_proposal</code>）的触发条件存在缺陷。例如，它需要提案获得足够的票数，但投票机制本身可以被操纵（如模式1所述）。</li>
<li><strong>跨合约交互安全漏洞</strong>：该函数被设计成一个“指令执行器”。它会获取用户提供的数据参数（例如，一个<code>Proposal</code>对象中的目标模块地址、函数名、参数），并基于这些数据参数在同一个交易中构造并执行一个跨模块调用。</li>
</ol>
</li>
<li>
<p><strong>攻击流程</strong>：</p>
<ol>
<li>攻击者找到一个能够执行任意调用的函数。这个函数本身就是一个“指令执行器”。</li>
<li>攻击者精心构造一份“指令集”（例如，创建一个提案），将目标指向一个存有资金的合约（如 <code>Treasury</code> ），指令内容是调用该合约的 <code>withdraw</code> 函数，并将资金转到攻击者地址。</li>
<li>攻击者通过另一个漏洞（如模式1的漏洞）或其他逻辑漏洞，满足了调用这个“指令执行器”函数的前提条件。</li>
<li>当函数被调用时，拥有<code>Treasury</code>对象所有权或访问权的DAO合约，会代表攻击者去执行提款的操作。攻击者本人从未直接获得<code>&amp;mut Treasury</code>，但他成功地让DAO合约为他调用了需要该权限的函数。</li>
</ol>
</li>
<li>
<p><strong>真实世界映射</strong>：
这个模式是对<strong>智能合约作为可信中介</strong>的信任滥用。</p>
<ul>
<li>可以把<code>DAO</code>合约想象成一个由社区管理的<strong>智能合约金库</strong>或一个<strong>去中心化基金会</strong>。它被设计用来保管核心资产（<code>Treasury</code>对象），并只根据一套严格的治理规则（提案和投票系统）来动用这些资产。</li>
<li><code>Treasury</code>对象就是被安全地锁在这个金库里的<strong>社区资产</strong>。</li>
<li>攻击者并未试图直接撬开金库的锁（即绕过<code>Treasury</code>对象的所有权规则），这是Sui的对象模型所极力防止的。</li>
<li>相反，攻击者攻击的是<strong>金库的管理模式</strong>（即提案投票逻辑）。通过利用管理模式的漏洞，攻击者伪造了一份看起来完全合规的“提款申请”（一个被恶意投票通过的提案）。</li>
<li>金库合约，作为一个规则执行者，在验证到“提款申请”符合所有程序后，便会<strong>误用自己的合法权限</strong>，亲自打开金库，将资产转移给攻击者。</li>
</ul>
</li>
</ul>
<h4 id="模式3defi模型利用"><a class="header" href="#模式3defi模型利用"><strong>模式3：Defi模型利用</strong></a></h4>
<p>很多CTF的出题方式会以Defi为基础模型（例如AMM，Lending），漏洞往往不是前面提到的一些通用类型漏洞，而是经济模型的缺陷，这需要我们去了解更多的Defi知识和Defi中常见的攻击方式。</p>
<ul>
<li><strong>攻击场景：价格预言机操纵</strong>
<ul>
<li><strong>背景</strong>：一个借贷协议使用某个去中心化交易所（DEX）的交易对价格作为预言机，来计算抵押品的价值。</li>
<li><strong>漏洞组合</strong>：
<ol>
<li><strong>闪电贷</strong>：攻击者从Lending协议中利用闪电贷借出巨额资金（例如100万SUI），无需抵押，只需在同一个交易内归还。</li>
<li><strong>不稳定的价格预言机</strong>：DEX的价格会因为一笔大额交易而产生巨大滑点。</li>
</ol>
</li>
<li><strong>攻击流程</strong>：
<ol>
<li>创建一个原子交易。</li>
<li>通过闪电贷借入大量SUI。</li>
<li>在作为预言机的DEX中，用借来的SUI大量买入某种代币X，瞬间拉高X的价格。</li>
<li>在目标借贷协议中，以被拉高了数倍的价格抵押少量代币X，借出远超其真实价值的SUI。</li>
<li>在DEX中卖掉代币X，将价格恢复原状。</li>
<li>归还闪电贷，带着借出的超额SUI离场。</li>
</ol>
</li>
<li><strong>CTF体现</strong>：题目会提供一个闪电贷协议、一个DEX和一个借贷合约。你需要编写一个<code>exploit</code>函数，在一个交易中完成上述所有步骤。</li>
</ul>
</li>
</ul>
<hr />
<h3 id="三-解决综合性挑战的战略框架"><a class="header" href="#三-解决综合性挑战的战略框架"><strong>三、 解决综合性挑战的战略框架</strong></a></h3>
<p>当你面对一个复杂的CTF题目时，不要一头扎进代码里。遵循以下步骤：</p>
<p><strong>Step 1：目标侦察</strong></p>
<ul>
<li><strong>确定获取flag的条件</strong>：<code>is_solved()</code>函数如何变为<code>true</code>？目标是清空某个金库的余额吗？还是将自己的地址变为<code>owner</code>？<strong>清晰的目标是所有行动的起点。</strong></li>
<li><strong>识别核心资产与高权限函数</strong>：找到存储资金的<code>Balance</code>或<code>Coin</code>对象。找到那些看起来最危险的函数，如<code>withdraw</code>, <code>execute</code>, <code>migrate</code>, <code>set_admin</code>等。这些是你的最终攻击目标。</li>
</ul>
<p><strong>Step 2：漏洞分析</strong></p>
<ul>
<li><strong>系统性审计</strong>：带着前几节课的清单，逐一检查所有合约：
<ul>
<li>函数中有没有泛型 <code>T</code> 却没有做类型限制？</li>
<li>涉及权限的操作，是否严格验证了<code>tx_context::sender</code>？</li>
<li>数学计算是否存在溢出或精度损失风险？</li>
<li>对象的所有权和共享属性是否合理？</li>
</ul>
</li>
<li><strong>寻找你的“第一把钥匙”</strong>：找到最容易利用的那个漏洞，作为你攻击链的起点。也许你不能直接用它偷钱，但它可能让你获得一个之前没有的“身份”或“能力”。</li>
</ul>
<p><strong>Step 3：攻击路径规划与攻击链构建</strong></p>
<ul>
<li><strong>正向推导</strong>：从你的立足点开始，“我现在能创建伪造的NFT了，有了这个NFT，我能调用哪个新函数？哦，可以调用<code>propose</code>。提案能做什么？能指定任意调用……”</li>
<li><strong>反向推导</strong>：从最终目标开始，“我要调用<code>withdraw</code>，需要<code>&amp;mut Treasury</code>。谁能给我这个引用？<code>execute_proposal</code>函数可以。要执行提案，需要100个投票。我如何获得100个投票？……”</li>
<li><strong>绘制攻击图</strong>：将合约、函数、状态和漏洞作为节点，用线连接它们，直到从你的起点（初始漏洞）到终点（目标达成）有一条清晰的路径。</li>
</ul>
<p><strong>Step 4：Exp编写</strong></p>
<ul>
<li><strong>编写<code>exploit</code>模块</strong>：在CTF中，通常需要你编写一个<code>exploit.move</code>文件。将你的攻击逻辑封装在一个<code>attack</code>函数中，清晰地展示你的攻击步骤。</li>
</ul>
<hr />
<h3 id="结语"><a class="header" href="#结语"><strong>结语</strong></a></h3>
<p>恭喜你完成了整个Sui Move CTF课程！安全是一个永无止境的攻防游戏，技术的更新迭代会带来新的攻击面。但今天你在这里学到的Move CTF挑战课程，将是你未来应对任何未知挑战的基石。</p>
<p>真正的学习始于课程结束之后。去挑战真实的CTF比赛，去审计开源项目，去不断地实践和思考。祝你在Web3的安全世界中，既能成为坚不可摧的建设者，也能成为洞察一切的智者。旅途愉快！</p>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ctfbook/chapter_8/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ctfbook/chapter_8/practice.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ctfbook/chapter_8/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ctfbook/chapter_8/practice.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
